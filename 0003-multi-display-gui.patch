From cecfe4d45f3ff5adbbcab720ccbb9c96165355f1 Mon Sep 17 00:00:00 2001
From: Alexander Hirzel <alex@hirzel.us>
Date: Mon, 7 Jan 2013 22:14:49 -0500
Subject: [PATCH] Add support for multiple screens.
Modified by: jellysheep

---
 data/guake.schemas |   64 +++++--
 data/prefs.glade   |  506 +++++++++++++++++++++++++++++++++++++++++++---------
 src/guake          |   37 +++-
 src/prefs.py       |   79 ++++++--
 4 files changed, 561 insertions(+), 125 deletions(-)

diff --git a/data/guake.schemas b/data/guake.schemas
index 4c614a2..d720b4b 100644
--- a/data/guake.schemas
+++ b/data/guake.schemas
@@ -2,6 +2,34 @@
     <schemalist>
 
         <schema>
+            <key>/schemas/apps/guake/general/primary_display</key>
+            <applyto>/apps/guake/general/primary_display</applyto>
+            <owner>guake</owner>
+            <type>bool</type>
+            <default>true</default>
+            <locale name="C">
+                <short>Appear on the primary display.</short>
+                <long>Appear on the primary display. This overrides any setting
+                in display_n.</long>
+            </locale>
+        </schema>
+
+        <schema>
+            <key>/schemas/apps/guake/general/display_n</key>
+            <applyto>/apps/guake/general/display_n</applyto>
+            <owner>guake</owner>
+            <type>int</type>
+            <default>0</default>
+            <locale name="C">
+                <short>Display to appear on.</short>
+                <long>Display to appear on if the primary_display option is not
+                set. If this is set to an invalid value (as in the case of
+                removing a screen from a system), the invalid value is
+                automatically updated to the current primary screen.</long>
+            </locale>
+        </schema>
+
+        <schema>
             <key>/schemas/apps/guake/general/default_shell</key>
             <applyto>/apps/guake/general/default_shell</applyto>
             <owner>guake</owner>
@@ -28,7 +56,7 @@
             </locale>
         </schema>
 
-	<schema>
+        <schema>
             <key>/schemas/apps/guake/general/use_trayicon</key>
             <applyto>/apps/guake/general/use_trayicon</applyto>
             <owner>guake</owner>
@@ -40,7 +68,7 @@
             </locale>
         </schema>
 
-	<schema>
+        <schema>
             <key>/schemas/apps/guake/general/use_popup</key>
             <applyto>/apps/guake/general/use_popup</applyto>
             <owner>guake</owner>
@@ -53,7 +81,7 @@
             </locale>
         </schema>
 
-	<schema>
+        <schema>
             <key>/schemas/apps/guake/general/prompt_on_quit</key>
             <applyto>/apps/guake/general/prompt_on_quit</applyto>
             <owner>guake</owner>
@@ -117,7 +145,7 @@
             </locale>
         </schema>
 
-	<schema>
+        <schema>
             <key>/schemas/apps/guake/general/window_width</key>
             <applyto>/apps/guake/general/window_width</applyto>
             <owner>guake</owner>
@@ -130,7 +158,7 @@
             </locale>
         </schema>
 
-	<schema>
+        <schema>
             <key>/schemas/apps/guake/general/window_height</key>
             <applyto>/apps/guake/general/window_height</applyto>
             <owner>guake</owner>
@@ -143,18 +171,18 @@
             </locale>
         </schema>
 
-	<schema>
-	    <key>/schemas/apps/guake/general/window_halignment</key>
-	    <applyto>/apps/guake/general/window_halignment</applyto>
-	    <owner>guake</owner>
-	    <type>int</type>
-	    <default>0</default>
-	    <locale name="C">
-	    <short>Window horizontal alignment.</short>
-	    <long>Place Guake at:
-	          0: center, 1: left, 2: right</long>
-	    </locale>
-	</schema>
+        <schema>
+            <key>/schemas/apps/guake/general/window_halignment</key>
+            <applyto>/apps/guake/general/window_halignment</applyto>
+            <owner>guake</owner>
+            <type>int</type>
+            <default>0</default>
+            <locale name="C">
+            <short>Window horizontal alignment.</short>
+            <long>Place Guake at:
+                  0: center, 1: left, 2: right</long>
+            </locale>
+        </schema>
 
         <schema>
             <key>/schemas/apps/guake/general/use_scrollbar</key>
@@ -220,7 +248,7 @@
             </locale>
         </schema>
 
-	<schema>
+        <schema>
             <key>/schemas/apps/guake/general/use_vte_titles</key>
             <applyto>/apps/guake/general/use_vte_titles</applyto>
             <owner>guake</owner>
diff --git a/data/prefs.glade b/data/prefs.glade
index d486210..13a624b 100644
--- a/data/prefs.glade
+++ b/data/prefs.glade
@@ -1,8 +1,9 @@
-<?xml version="1.0"?>
+<?xml version="1.0" encoding="UTF-8"?>
 <glade-interface>
   <!-- interface-requires gtk+ 2.16 -->
   <!-- interface-naming-policy toplevel-contextual -->
   <widget class="GtkWindow" id="config-window">
+    <property name="can_focus">False</property>
     <property name="title" translatable="yes">Guake Preferences</property>
     <property name="window_position">center-always</property>
     <property name="default_width">460</property>
@@ -10,22 +11,27 @@
     <child>
       <widget class="GtkVBox" id="vbox4">
         <property name="visible">True</property>
+        <property name="can_focus">False</property>
         <child>
           <widget class="GtkVBox" id="vbox5">
             <property name="visible">True</property>
+            <property name="can_focus">False</property>
             <child>
               <widget class="GtkEventBox" id="eventbox-title">
                 <property name="height_request">70</property>
                 <property name="visible">True</property>
+                <property name="can_focus">False</property>
                 <child>
                   <widget class="GtkHBox" id="hbox29">
                     <property name="visible">True</property>
+                    <property name="can_focus">False</property>
                     <property name="border_width">12</property>
                     <child>
                       <widget class="GtkImage" id="image_logo">
                         <property name="width_request">60</property>
                         <property name="height_request">60</property>
                         <property name="visible">True</property>
+                        <property name="can_focus">False</property>
                         <property name="stock">gtk-missing-image</property>
                       </widget>
                       <packing>
@@ -37,32 +43,41 @@
                     <child>
                       <widget class="GtkVBox" id="vbox22">
                         <property name="visible">True</property>
+                        <property name="can_focus">False</property>
                         <child>
                           <widget class="GtkLabel" id="titleLabel">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="xalign">0</property>
                             <property name="yalign">1</property>
                             <property name="label" translatable="yes">&lt;span size="18000" color="black"&gt;&lt;b&gt;Guake properties&lt;/b&gt;&lt;/span&gt;</property>
                             <property name="use_markup">True</property>
                           </widget>
                           <packing>
+                            <property name="expand">True</property>
+                            <property name="fill">True</property>
                             <property name="position">0</property>
                           </packing>
                         </child>
                         <child>
                           <widget class="GtkLabel" id="label4825">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="xalign">0</property>
                             <property name="yalign">0</property>
                             <property name="label" translatable="yes">&lt;span color="black"&gt;Customize behavior and appearance of Guake!&lt;/span&gt;</property>
                             <property name="use_markup">True</property>
                           </widget>
                           <packing>
+                            <property name="expand">True</property>
+                            <property name="fill">True</property>
                             <property name="position">1</property>
                           </packing>
                         </child>
                       </widget>
                       <packing>
+                        <property name="expand">True</property>
+                        <property name="fill">True</property>
                         <property name="position">1</property>
                       </packing>
                     </child>
@@ -71,15 +86,18 @@
               </widget>
               <packing>
                 <property name="expand">False</property>
+                <property name="fill">True</property>
                 <property name="position">0</property>
               </packing>
             </child>
             <child>
               <widget class="GtkHSeparator" id="hseparator1">
                 <property name="visible">True</property>
+                <property name="can_focus">False</property>
               </widget>
               <packing>
                 <property name="expand">False</property>
+                <property name="fill">True</property>
                 <property name="position">1</property>
               </packing>
             </child>
@@ -93,37 +111,45 @@
         <child>
           <widget class="GtkVBox" id="vbox1">
             <property name="visible">True</property>
+            <property name="can_focus">False</property>
             <property name="border_width">12</property>
             <property name="spacing">10</property>
             <child>
               <widget class="GtkNotebook" id="tabs">
                 <property name="visible">True</property>
+                <property name="can_focus">False</property>
                 <child>
                   <widget class="GtkVBox" id="vbox3">
                     <property name="visible">True</property>
+                    <property name="can_focus">False</property>
                     <property name="border_width">6</property>
                     <property name="spacing">10</property>
                     <child>
                       <widget class="GtkFrame" id="frame5">
                         <property name="visible">True</property>
+                        <property name="can_focus">False</property>
                         <property name="label_xalign">0</property>
                         <property name="shadow_type">none</property>
                         <child>
                           <widget class="GtkAlignment" id="alignment5">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="left_padding">12</property>
                             <child>
                               <widget class="GtkVBox" id="vbox8">
                                 <property name="visible">True</property>
+                                <property name="can_focus">False</property>
                                 <property name="spacing">6</property>
                                 <property name="homogeneous">True</property>
                                 <child>
                                   <widget class="GtkHBox" id="hbox1">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <child>
                                       <widget class="GtkLabel" id="lblChooseShell1">
                                         <property name="width_request">160</property>
                                         <property name="visible">True</property>
+                                        <property name="can_focus">False</property>
                                         <property name="xalign">0</property>
                                         <property name="label" translatable="yes">Default interpreter:</property>
                                         <property name="use_markup">True</property>
@@ -137,15 +163,20 @@
                                     <child>
                                       <widget class="GtkComboBox" id="default_shell">
                                         <property name="visible">True</property>
-                                        <property name="items" translatable="yes"></property>
+                                        <property name="can_focus">False</property>
+                                        <property name="items" translatable="yes"/>
                                         <signal name="changed" handler="on_default_shell_changed"/>
                                       </widget>
                                       <packing>
+                                        <property name="expand">True</property>
+                                        <property name="fill">True</property>
                                         <property name="position">1</property>
                                       </packing>
                                     </child>
                                   </widget>
                                   <packing>
+                                    <property name="expand">True</property>
+                                    <property name="fill">True</property>
                                     <property name="position">0</property>
                                   </packing>
                                 </child>
@@ -156,11 +187,14 @@
                                     <property name="can_focus">True</property>
                                     <property name="receives_default">False</property>
                                     <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
+                                    <property name="use_action_appearance">False</property>
                                     <property name="use_underline">True</property>
                                     <property name="draw_indicator">True</property>
                                     <signal name="toggled" handler="on_use_login_shell_toggled"/>
                                   </widget>
                                   <packing>
+                                    <property name="expand">True</property>
+                                    <property name="fill">True</property>
                                     <property name="position">1</property>
                                   </packing>
                                 </child>
@@ -171,11 +205,14 @@
                                     <property name="can_focus">True</property>
                                     <property name="receives_default">False</property>
                                     <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
+                                    <property name="use_action_appearance">False</property>
                                     <property name="use_underline">True</property>
                                     <property name="draw_indicator">True</property>
                                     <signal name="toggled" handler="on_open_tab_cwd_toggled"/>
                                   </widget>
                                   <packing>
+                                    <property name="expand">True</property>
+                                    <property name="fill">True</property>
                                     <property name="position">2</property>
                                   </packing>
                                 </child>
@@ -186,6 +223,7 @@
                         <child>
                           <widget class="GtkLabel" id="label13">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="ypad">6</property>
                             <property name="label" translatable="yes">&lt;b&gt;Shell&lt;/b&gt;</property>
                             <property name="use_markup">True</property>
@@ -196,21 +234,26 @@
                         </child>
                       </widget>
                       <packing>
+                        <property name="expand">True</property>
+                        <property name="fill">True</property>
                         <property name="position">0</property>
                       </packing>
                     </child>
                     <child>
                       <widget class="GtkFrame" id="frame7">
                         <property name="visible">True</property>
+                        <property name="can_focus">False</property>
                         <property name="label_xalign">0</property>
                         <property name="shadow_type">none</property>
                         <child>
                           <widget class="GtkAlignment" id="alignment8">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="left_padding">12</property>
                             <child>
                               <widget class="GtkVBox" id="vbox2">
                                 <property name="visible">True</property>
+                                <property name="can_focus">False</property>
                                 <property name="spacing">6</property>
                                 <property name="homogeneous">True</property>
                                 <child>
@@ -220,10 +263,13 @@
                                     <property name="can_focus">True</property>
                                     <property name="receives_default">False</property>
                                     <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
+                                    <property name="use_action_appearance">False</property>
                                     <property name="draw_indicator">True</property>
                                     <signal name="toggled" handler="on_use_trayicon_toggled"/>
                                   </widget>
                                   <packing>
+                                    <property name="expand">True</property>
+                                    <property name="fill">True</property>
                                     <property name="position">0</property>
                                   </packing>
                                 </child>
@@ -234,10 +280,13 @@
                                     <property name="can_focus">True</property>
                                     <property name="receives_default">False</property>
                                     <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
+                                    <property name="use_action_appearance">False</property>
                                     <property name="draw_indicator">True</property>
                                     <signal name="toggled" handler="on_use_popup_toggled"/>
                                   </widget>
                                   <packing>
+                                    <property name="expand">True</property>
+                                    <property name="fill">True</property>
                                     <property name="position">1</property>
                                   </packing>
                                 </child>
@@ -248,10 +297,13 @@
                                     <property name="can_focus">True</property>
                                     <property name="receives_default">False</property>
                                     <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
+                                    <property name="use_action_appearance">False</property>
                                     <property name="draw_indicator">True</property>
                                     <signal name="toggled" handler="on_prompt_on_quit_toggled"/>
                                   </widget>
                                   <packing>
+                                    <property name="expand">True</property>
+                                    <property name="fill">True</property>
                                     <property name="position">2</property>
                                   </packing>
                                 </child>
@@ -262,6 +314,7 @@
                         <child>
                           <widget class="GtkLabel" id="label8">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="ypad">6</property>
                             <property name="label" translatable="yes">&lt;b&gt;General&lt;/b&gt;</property>
                             <property name="use_markup">True</property>
@@ -272,113 +325,269 @@
                         </child>
                       </widget>
                       <packing>
+                        <property name="expand">True</property>
+                        <property name="fill">True</property>
                         <property name="position">1</property>
                       </packing>
                     </child>
                     <child>
-                      <widget class="GtkFrame" id="frame4">
+                      <widget class="GtkHBox" id="hbox5">
                         <property name="visible">True</property>
-                        <property name="label_xalign">0</property>
-                        <property name="shadow_type">none</property>
+                        <property name="can_focus">False</property>
+                        <property name="homogeneous">True</property>
                         <child>
-                          <widget class="GtkAlignment" id="alignment4">
+                          <widget class="GtkFrame" id="frame4">
                             <property name="visible">True</property>
-                            <property name="left_padding">12</property>
+                            <property name="can_focus">False</property>
+                            <property name="label_xalign">0</property>
+                            <property name="shadow_type">none</property>
                             <child>
-                              <widget class="GtkVBox" id="vbox11">
+                              <widget class="GtkAlignment" id="alignment4">
                                 <property name="visible">True</property>
-                                <property name="spacing">6</property>
-                                <property name="homogeneous">True</property>
+                                <property name="can_focus">False</property>
+                                <property name="left_padding">12</property>
                                 <child>
-                                  <widget class="GtkCheckButton" id="window_ontop">
-                                    <property name="label" translatable="yes">Stay on top</property>
+                                  <widget class="GtkVBox" id="vbox11">
                                     <property name="visible">True</property>
                                     <property name="can_focus">False</property>
-                                    <property name="receives_default">False</property>
-                                    <property name="use_underline">True</property>
-                                    <property name="focus_on_click">False</property>
-                                    <property name="active">True</property>
-                                    <property name="draw_indicator">True</property>
-                                    <signal name="toggled" handler="on_window_ontop_toggled"/>
-                                  </widget>
-                                  <packing>
-                                    <property name="expand">False</property>
-                                    <property name="position">0</property>
-                                  </packing>
-                                </child>
-                                <child>
-                                  <widget class="GtkCheckButton" id="window_losefocus">
-                                    <property name="label" translatable="yes">Hide on lose focus</property>
-                                    <property name="visible">True</property>
-                                    <property name="can_focus">True</property>
-                                    <property name="receives_default">False</property>
-                                    <property name="use_underline">True</property>
-                                    <property name="active">True</property>
-                                    <property name="draw_indicator">True</property>
-                                    <signal name="toggled" handler="on_window_losefocus_toggled"/>
-                                  </widget>
-                                  <packing>
-                                    <property name="expand">False</property>
-                                    <property name="fill">False</property>
-                                    <property name="position">1</property>
-                                  </packing>
-                                </child>
-                                <child>
-                                  <widget class="GtkCheckButton" id="window_tabbar">
-                                    <property name="label" translatable="yes">Show tab bar</property>
-                                    <property name="visible">True</property>
-                                    <property name="can_focus">True</property>
-                                    <property name="receives_default">False</property>
-                                    <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
-                                    <property name="draw_indicator">True</property>
-                                    <signal name="toggled" handler="on_window_tabbar_toggled"/>
-                                  </widget>
-                                  <packing>
-                                    <property name="position">2</property>
-                                  </packing>
-                                </child>
-                                <child>
-                                  <widget class="GtkCheckButton" id="start_fullscreen">
-                                    <property name="label" translatable="yes">Start fullscreen</property>
-                                    <property name="visible">True</property>
-                                    <property name="can_focus">True</property>
-                                    <property name="receives_default">False</property>
-                                    <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
-                                    <property name="draw_indicator">True</property>
-                                    <signal name="toggled" handler="on_start_fullscreen_toggled"/>
+                                    <property name="spacing">6</property>
+                                    <property name="homogeneous">True</property>
+                                    <child>
+                                      <widget class="GtkCheckButton" id="window_ontop">
+                                        <property name="label" translatable="yes">Stay on top</property>
+                                        <property name="visible">True</property>
+                                        <property name="can_focus">True</property>
+                                        <property name="receives_default">False</property>
+                                        <property name="use_action_appearance">False</property>
+                                        <property name="use_underline">True</property>
+                                        <property name="focus_on_click">False</property>
+                                        <property name="active">True</property>
+                                        <property name="draw_indicator">True</property>
+                                        <signal name="toggled" handler="on_window_ontop_toggled"/>
+                                      </widget>
+                                      <packing>
+                                        <property name="expand">False</property>
+                                        <property name="fill">True</property>
+                                        <property name="position">0</property>
+                                      </packing>
+                                    </child>
+                                    <child>
+                                      <widget class="GtkCheckButton" id="window_losefocus">
+                                        <property name="label" translatable="yes">Hide on lose focus</property>
+                                        <property name="visible">True</property>
+                                        <property name="can_focus">True</property>
+                                        <property name="receives_default">False</property>
+                                        <property name="use_action_appearance">False</property>
+                                        <property name="use_underline">True</property>
+                                        <property name="active">True</property>
+                                        <property name="draw_indicator">True</property>
+                                        <signal name="toggled" handler="on_window_losefocus_toggled"/>
+                                      </widget>
+                                      <packing>
+                                        <property name="expand">False</property>
+                                        <property name="fill">False</property>
+                                        <property name="position">1</property>
+                                      </packing>
+                                    </child>
+                                    <child>
+                                      <widget class="GtkCheckButton" id="window_tabbar">
+                                        <property name="label" translatable="yes">Show tab bar</property>
+                                        <property name="visible">True</property>
+                                        <property name="can_focus">True</property>
+                                        <property name="receives_default">False</property>
+                                        <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
+                                        <property name="use_action_appearance">False</property>
+                                        <property name="draw_indicator">True</property>
+                                        <signal name="toggled" handler="on_window_tabbar_toggled"/>
+                                      </widget>
+                                      <packing>
+                                        <property name="expand">True</property>
+                                        <property name="fill">True</property>
+                                        <property name="position">2</property>
+                                      </packing>
+                                    </child>
+                                    <child>
+                                      <widget class="GtkCheckButton" id="start_fullscreen">
+                                        <property name="label" translatable="yes">Start fullscreen</property>
+                                        <property name="visible">True</property>
+                                        <property name="can_focus">True</property>
+                                        <property name="receives_default">False</property>
+                                        <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
+                                        <property name="use_action_appearance">False</property>
+                                        <property name="draw_indicator">True</property>
+                                        <signal name="toggled" handler="on_start_fullscreen_toggled"/>
+                                      </widget>
+                                      <packing>
+                                        <property name="expand">True</property>
+                                        <property name="fill">True</property>
+                                        <property name="position">3</property>
+                                      </packing>
+                                    </child>
                                   </widget>
-                                  <packing>
-                                    <property name="position">3</property>
-                                  </packing>
                                 </child>
                               </widget>
                             </child>
+                            <child>
+                              <widget class="GtkLabel" id="label20">
+                                <property name="visible">True</property>
+                                <property name="can_focus">False</property>
+                                <property name="ypad">6</property>
+                                <property name="label" translatable="yes">&lt;b&gt;Main Window&lt;/b&gt;</property>
+                                <property name="use_markup">True</property>
+                              </widget>
+                              <packing>
+                                <property name="type">label_item</property>
+                              </packing>
+                            </child>
                           </widget>
+                          <packing>
+                            <property name="expand">True</property>
+                            <property name="fill">True</property>
+                            <property name="position">0</property>
+                          </packing>
                         </child>
                         <child>
-                          <widget class="GtkLabel" id="label20">
+                          <widget class="GtkFrame" id="frame1">
                             <property name="visible">True</property>
-                            <property name="ypad">6</property>
-                            <property name="label" translatable="yes">&lt;b&gt;Main Window&lt;/b&gt;</property>
-                            <property name="use_markup">True</property>
+                            <property name="can_focus">False</property>
+                            <property name="label_xalign">0</property>
+                            <property name="shadow_type">none</property>
+                            <child>
+                              <widget class="GtkAlignment" id="alignment2">
+                                <property name="visible">True</property>
+                                <property name="can_focus">False</property>
+                                <property name="left_padding">12</property>
+                                <child>
+                                  <widget class="GtkVBox" id="vbox10">
+                                    <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
+                                    <property name="homogeneous">True</property>
+                                    <child>
+                                      <widget class="GtkCheckButton" id="primary_display">
+                                        <property name="label" translatable="yes">Appear on primary display</property>
+                                        <property name="visible">True</property>
+                                        <property name="can_focus">True</property>
+                                        <property name="receives_default">False</property>
+                                        <property name="use_action_appearance">False</property>
+                                        <property name="draw_indicator">True</property>
+                                        <signal name="toggled" handler="on_primary_display_toggled"/>
+                                        <signal name="toggled" handler="toggle_display_n_sensitivity"/>
+                                      </widget>
+                                      <packing>
+                                        <property name="expand">True</property>
+                                        <property name="fill">False</property>
+                                        <property name="position">0</property>
+                                      </packing>
+                                    </child>
+                                    <child>
+                                      <widget class="GtkHBox" id="hbox6">
+                                        <property name="visible">True</property>
+                                        <property name="can_focus">False</property>
+                                        <property name="homogeneous">True</property>
+                                        <child>
+                                          <widget class="GtkLabel" id="lblDisplay">
+                                            <property name="width_request">160</property>
+                                            <property name="visible">True</property>
+                                            <property name="can_focus">False</property>
+                                            <property name="xalign">0</property>
+                                            <property name="label" translatable="yes">Appear on display:</property>
+                                            <property name="use_markup">True</property>
+                                            <property name="single_line_mode">True</property>
+                                          </widget>
+                                          <packing>
+                                            <property name="expand">False</property>
+                                            <property name="fill">False</property>
+                                            <property name="position">0</property>
+                                          </packing>
+                                        </child>
+                                        <child>
+                                          <widget class="GtkComboBox" id="display_n">
+                                            <property name="visible">True</property>
+                                            <property name="can_focus">False</property>
+                                            <property name="items" translatable="yes"/>
+                                            <signal name="changed" handler="on_display_n_changed"/>
+                                          </widget>
+                                          <packing>
+                                            <property name="expand">True</property>
+                                            <property name="fill">True</property>
+                                            <property name="position">1</property>
+                                          </packing>
+                                        </child>
+                                      </widget>
+                                      <packing>
+                                        <property name="expand">True</property>
+                                        <property name="fill">True</property>
+                                        <property name="position">1</property>
+                                      </packing>
+                                    </child>
+                                    <child>
+                                      <widget class="GtkLabel" id="lblSpacer">
+                                        <property name="width_request">160</property>
+                                        <property name="visible">True</property>
+                                        <property name="can_focus">False</property>
+                                        <property name="xalign">0</property>
+                                        <property name="use_markup">True</property>
+                                      </widget>
+                                      <packing>
+                                        <property name="expand">False</property>
+                                        <property name="fill">False</property>
+                                        <property name="position">2</property>
+                                      </packing>
+                                    </child>
+                                    <child>
+                                      <widget class="GtkLabel" id="lblSpacer2">
+                                        <property name="width_request">160</property>
+                                        <property name="visible">True</property>
+                                        <property name="can_focus">False</property>
+                                        <property name="xalign">0</property>
+                                        <property name="use_markup">True</property>
+                                      </widget>
+                                      <packing>
+                                        <property name="expand">False</property>
+                                        <property name="fill">False</property>
+                                        <property name="position">3</property>
+                                      </packing>
+                                    </child>
+                                  </widget>
+                                </child>
+                              </widget>
+                            </child>
+                            <child>
+                              <widget class="GtkLabel" id="label2">
+                                <property name="visible">True</property>
+                                <property name="can_focus">False</property>
+                                <property name="ypad">6</property>
+                                <property name="label" translatable="yes">&lt;b&gt;Placement&lt;/b&gt;</property>
+                                <property name="use_markup">True</property>
+                              </widget>
+                              <packing>
+                                <property name="type">label_item</property>
+                              </packing>
+                            </child>
                           </widget>
                           <packing>
-                            <property name="type">label_item</property>
+                            <property name="expand">True</property>
+                            <property name="fill">True</property>
+                            <property name="position">1</property>
                           </packing>
                         </child>
                       </widget>
                       <packing>
+                        <property name="expand">True</property>
+                        <property name="fill">True</property>
                         <property name="position">2</property>
                       </packing>
                     </child>
                     <child>
                       <widget class="GtkFrame" id="frame11">
                         <property name="visible">True</property>
+                        <property name="can_focus">False</property>
                         <property name="label_xalign">0</property>
                         <property name="shadow_type">none</property>
                         <child>
                           <widget class="GtkAlignment" id="alignment11">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="left_padding">12</property>
                             <child>
                               <widget class="GtkHScale" id="window_height">
@@ -397,6 +606,7 @@
                         <child>
                           <widget class="GtkLabel" id="label24">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="ypad">6</property>
                             <property name="label" translatable="yes">&lt;b&gt;Main Window height&lt;/b&gt;</property>
                             <property name="use_markup">True</property>
@@ -407,6 +617,8 @@
                         </child>
                       </widget>
                       <packing>
+                        <property name="expand">True</property>
+                        <property name="fill">True</property>
                         <property name="position">3</property>
                       </packing>
                     </child>
@@ -415,6 +627,7 @@
                 <child>
                   <widget class="GtkLabel" id="label6">
                     <property name="visible">True</property>
+                    <property name="can_focus">False</property>
                     <property name="label" translatable="yes">General</property>
                     <property name="use_markup">True</property>
                   </widget>
@@ -426,18 +639,22 @@
                 <child>
                   <widget class="GtkVBox" id="vbox12">
                     <property name="visible">True</property>
+                    <property name="can_focus">False</property>
                     <child>
                       <widget class="GtkFrame" id="frame6">
                         <property name="visible">True</property>
+                        <property name="can_focus">False</property>
                         <property name="label_xalign">0</property>
                         <property name="shadow_type">none</property>
                         <child>
                           <widget class="GtkAlignment" id="alignment6">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="left_padding">12</property>
                             <child>
                               <widget class="GtkVBox" id="vbox13">
                                 <property name="visible">True</property>
+                                <property name="can_focus">False</property>
                                 <property name="spacing">6</property>
                                 <property name="homogeneous">True</property>
                                 <child>
@@ -447,20 +664,25 @@
                                     <property name="can_focus">True</property>
                                     <property name="receives_default">False</property>
                                     <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
+                                    <property name="use_action_appearance">False</property>
                                     <property name="draw_indicator">True</property>
                                     <signal name="toggled" handler="on_use_scrollbar_toggled"/>
                                   </widget>
                                   <packing>
+                                    <property name="expand">True</property>
+                                    <property name="fill">True</property>
                                     <property name="position">0</property>
                                   </packing>
                                 </child>
                                 <child>
                                   <widget class="GtkHBox" id="hbox2">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <child>
                                       <widget class="GtkLabel" id="lblChooseShell3">
                                         <property name="width_request">120</property>
                                         <property name="visible">True</property>
+                                        <property name="can_focus">False</property>
                                         <property name="xalign">0</property>
                                         <property name="label" translatable="yes">Scrollback lines:</property>
                                         <property name="use_markup">True</property>
@@ -476,6 +698,10 @@
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
+                                        <property name="primary_icon_activatable">False</property>
+                                        <property name="secondary_icon_activatable">False</property>
+                                        <property name="primary_icon_sensitive">True</property>
+                                        <property name="secondary_icon_sensitive">True</property>
                                         <property name="adjustment">512 256 100000 1 1 0</property>
                                         <property name="snap_to_ticks">True</property>
                                         <property name="numeric">True</property>
@@ -483,11 +709,14 @@
                                       </widget>
                                       <packing>
                                         <property name="expand">False</property>
+                                        <property name="fill">True</property>
                                         <property name="position">1</property>
                                       </packing>
                                     </child>
                                   </widget>
                                   <packing>
+                                    <property name="expand">True</property>
+                                    <property name="fill">True</property>
                                     <property name="position">1</property>
                                   </packing>
                                 </child>
@@ -498,6 +727,7 @@
                         <child>
                           <widget class="GtkLabel" id="label11">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="ypad">6</property>
                             <property name="label" translatable="yes">&lt;b&gt;General&lt;/b&gt;</property>
                             <property name="use_markup">True</property>
@@ -509,21 +739,25 @@
                       </widget>
                       <packing>
                         <property name="expand">False</property>
+                        <property name="fill">True</property>
                         <property name="position">0</property>
                       </packing>
                     </child>
                     <child>
                       <widget class="GtkFrame" id="frame8">
                         <property name="visible">True</property>
+                        <property name="can_focus">False</property>
                         <property name="label_xalign">0</property>
                         <property name="shadow_type">none</property>
                         <child>
                           <widget class="GtkAlignment" id="alignment7">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="left_padding">12</property>
                             <child>
                               <widget class="GtkVBox" id="vbox14">
                                 <property name="visible">True</property>
+                                <property name="can_focus">False</property>
                                 <property name="spacing">6</property>
                                 <property name="homogeneous">True</property>
                                 <child>
@@ -533,10 +767,13 @@
                                     <property name="can_focus">True</property>
                                     <property name="receives_default">False</property>
                                     <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
+                                    <property name="use_action_appearance">False</property>
                                     <property name="draw_indicator">True</property>
                                     <signal name="toggled" handler="on_scroll_output_toggled"/>
                                   </widget>
                                   <packing>
+                                    <property name="expand">True</property>
+                                    <property name="fill">True</property>
                                     <property name="position">0</property>
                                   </packing>
                                 </child>
@@ -547,10 +784,13 @@
                                     <property name="can_focus">True</property>
                                     <property name="receives_default">False</property>
                                     <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
+                                    <property name="use_action_appearance">False</property>
                                     <property name="draw_indicator">True</property>
                                     <signal name="toggled" handler="on_scroll_keystroke_toggled"/>
                                   </widget>
                                   <packing>
+                                    <property name="expand">True</property>
+                                    <property name="fill">True</property>
                                     <property name="position">1</property>
                                   </packing>
                                 </child>
@@ -561,6 +801,7 @@
                         <child>
                           <widget class="GtkLabel" id="label15">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="ypad">6</property>
                             <property name="label" translatable="yes">&lt;b&gt;Scroll&lt;/b&gt;</property>
                             <property name="use_markup">True</property>
@@ -572,6 +813,7 @@
                       </widget>
                       <packing>
                         <property name="expand">False</property>
+                        <property name="fill">True</property>
                         <property name="position">1</property>
                       </packing>
                     </child>
@@ -583,6 +825,7 @@
                 <child>
                   <widget class="GtkLabel" id="label1">
                     <property name="visible">True</property>
+                    <property name="can_focus">False</property>
                     <property name="label" translatable="yes">Scrolling</property>
                   </widget>
                   <packing>
@@ -594,15 +837,18 @@
                 <child>
                   <widget class="GtkVBox" id="vbox6">
                     <property name="visible">True</property>
+                    <property name="can_focus">False</property>
                     <property name="border_width">10</property>
                     <property name="spacing">18</property>
                     <child>
                       <widget class="GtkVBox" id="vbox15">
                         <property name="visible">True</property>
+                        <property name="can_focus">False</property>
                         <property name="spacing">6</property>
                         <child>
                           <widget class="GtkLabel" id="label4">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="xalign">0</property>
                             <property name="label" translatable="yes">&lt;b&gt;General&lt;/b&gt;</property>
                             <property name="use_markup">True</property>
@@ -616,10 +862,12 @@
                         <child>
                           <widget class="GtkAlignment" id="alignment9">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="left_padding">12</property>
                             <child>
                               <widget class="GtkTable" id="table1">
                                 <property name="visible">True</property>
+                                <property name="can_focus">False</property>
                                 <property name="n_rows">4</property>
                                 <property name="n_columns">2</property>
                                 <property name="column_spacing">12</property>
@@ -630,6 +878,7 @@
                                     <property name="visible">True</property>
                                     <property name="can_focus">True</property>
                                     <property name="receives_default">False</property>
+                                    <property name="use_action_appearance">False</property>
                                     <property name="draw_indicator">True</property>
                                     <signal name="toggled" handler="on_use_default_font_toggled"/>
                                     <signal name="toggled" handler="toggle_style_sensitivity"/>
@@ -637,12 +886,13 @@
                                   <packing>
                                     <property name="right_attach">2</property>
                                     <property name="x_options">GTK_FILL</property>
-                                    <property name="y_options"></property>
+                                    <property name="y_options"/>
                                   </packing>
                                 </child>
                                 <child>
                                   <widget class="GtkLabel" id="label14">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <property name="xalign">0</property>
                                     <property name="label" translatable="yes">Font:</property>
                                     <property name="use_markup">True</property>
@@ -651,7 +901,7 @@
                                     <property name="top_attach">1</property>
                                     <property name="bottom_attach">2</property>
                                     <property name="x_options">GTK_FILL</property>
-                                    <property name="y_options"></property>
+                                    <property name="y_options"/>
                                   </packing>
                                 </child>
                                 <child>
@@ -659,6 +909,7 @@
                                     <property name="visible">True</property>
                                     <property name="can_focus">True</property>
                                     <property name="receives_default">True</property>
+                                    <property name="use_action_appearance">False</property>
                                     <property name="focus_on_click">False</property>
                                     <property name="title" translatable="yes">Choose some font</property>
                                     <signal name="font_set" handler="on_font_style_font_set"/>
@@ -668,12 +919,13 @@
                                     <property name="right_attach">2</property>
                                     <property name="top_attach">1</property>
                                     <property name="bottom_attach">2</property>
-                                    <property name="y_options"></property>
+                                    <property name="y_options"/>
                                   </packing>
                                 </child>
                                 <child>
                                   <widget class="GtkLabel" id="labelx2">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <property name="xalign">0</property>
                                     <property name="label" translatable="yes">Text color:</property>
                                     <property name="use_markup">True</property>
@@ -682,12 +934,13 @@
                                     <property name="top_attach">2</property>
                                     <property name="bottom_attach">3</property>
                                     <property name="x_options">GTK_FILL</property>
-                                    <property name="y_options"></property>
+                                    <property name="y_options"/>
                                   </packing>
                                 </child>
                                 <child>
                                   <widget class="GtkLabel" id="labelx3">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <property name="xalign">0</property>
                                     <property name="label" translatable="yes">Background color:</property>
                                     <property name="use_markup">True</property>
@@ -696,17 +949,19 @@
                                     <property name="top_attach">3</property>
                                     <property name="bottom_attach">4</property>
                                     <property name="x_options">GTK_FILL</property>
-                                    <property name="y_options"></property>
+                                    <property name="y_options"/>
                                   </packing>
                                 </child>
                                 <child>
                                   <widget class="GtkHBox" id="hbox10">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <child>
                                       <widget class="GtkColorButton" id="font_color">
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_font_color_color_set"/>
                                       </widget>
@@ -725,17 +980,19 @@
                                     <property name="right_attach">2</property>
                                     <property name="top_attach">2</property>
                                     <property name="bottom_attach">3</property>
-                                    <property name="y_options"></property>
+                                    <property name="y_options"/>
                                   </packing>
                                 </child>
                                 <child>
                                   <widget class="GtkHBox" id="hbox11">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <child>
                                       <widget class="GtkColorButton" id="background_color">
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_background_color_color_set"/>
                                       </widget>
@@ -754,28 +1011,34 @@
                                     <property name="right_attach">2</property>
                                     <property name="top_attach">3</property>
                                     <property name="bottom_attach">4</property>
-                                    <property name="y_options"></property>
+                                    <property name="y_options"/>
                                   </packing>
                                 </child>
                               </widget>
                             </child>
                           </widget>
                           <packing>
+                            <property name="expand">True</property>
+                            <property name="fill">True</property>
                             <property name="position">1</property>
                           </packing>
                         </child>
                       </widget>
                       <packing>
+                        <property name="expand">True</property>
+                        <property name="fill">True</property>
                         <property name="position">0</property>
                       </packing>
                     </child>
                     <child>
                       <widget class="GtkVBox" id="vbox16">
                         <property name="visible">True</property>
+                        <property name="can_focus">False</property>
                         <property name="spacing">6</property>
                         <child>
                           <widget class="GtkLabel" id="label16">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="xalign">0</property>
                             <property name="label" translatable="yes">&lt;b&gt;Palette&lt;/b&gt;</property>
                             <property name="use_markup">True</property>
@@ -789,10 +1052,12 @@
                         <child>
                           <widget class="GtkAlignment" id="alignment10">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="left_padding">12</property>
                             <child>
                               <widget class="GtkTable" id="table2">
                                 <property name="visible">True</property>
+                                <property name="can_focus">False</property>
                                 <property name="n_rows">2</property>
                                 <property name="n_columns">2</property>
                                 <property name="column_spacing">12</property>
@@ -800,18 +1065,20 @@
                                 <child>
                                   <widget class="GtkLabel" id="label17">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <property name="xalign">0</property>
                                     <property name="label" translatable="yes">Built-in schemes:</property>
                                     <property name="use_markup">True</property>
                                   </widget>
                                   <packing>
                                     <property name="x_options">GTK_FILL</property>
-                                    <property name="y_options"></property>
+                                    <property name="y_options"/>
                                   </packing>
                                 </child>
                                 <child>
                                   <widget class="GtkLabel" id="label18">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <property name="xalign">0</property>
                                     <property name="yalign">0</property>
                                     <property name="label" translatable="yes">Color palette:</property>
@@ -827,6 +1094,7 @@
                                 <child>
                                   <widget class="GtkComboBox" id="palette_name">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <property name="items" translatable="yes">Tango
 Linux console
 XTerm
@@ -838,12 +1106,13 @@ Custom
                                   <packing>
                                     <property name="left_attach">1</property>
                                     <property name="right_attach">2</property>
-                                    <property name="y_options"></property>
+                                    <property name="y_options"/>
                                   </packing>
                                 </child>
                                 <child>
                                   <widget class="GtkTable" id="table3">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <property name="n_rows">2</property>
                                     <property name="n_columns">8</property>
                                     <property name="column_spacing">6</property>
@@ -853,6 +1122,7 @@ Custom
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_palette_color_set"/>
                                       </widget>
@@ -862,6 +1132,7 @@ Custom
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_palette_color_set"/>
                                       </widget>
@@ -875,6 +1146,7 @@ Custom
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_palette_color_set"/>
                                       </widget>
@@ -888,6 +1160,7 @@ Custom
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_palette_color_set"/>
                                       </widget>
@@ -903,6 +1176,7 @@ Custom
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_palette_color_set"/>
                                       </widget>
@@ -918,6 +1192,7 @@ Custom
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_palette_color_set"/>
                                       </widget>
@@ -931,6 +1206,7 @@ Custom
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_palette_color_set"/>
                                       </widget>
@@ -946,6 +1222,7 @@ Custom
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_palette_color_set"/>
                                       </widget>
@@ -959,6 +1236,7 @@ Custom
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_palette_color_set"/>
                                       </widget>
@@ -972,6 +1250,7 @@ Custom
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_palette_color_set"/>
                                       </widget>
@@ -987,6 +1266,7 @@ Custom
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_palette_color_set"/>
                                       </widget>
@@ -1002,6 +1282,7 @@ Custom
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_palette_color_set"/>
                                       </widget>
@@ -1015,6 +1296,7 @@ Custom
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_palette_color_set"/>
                                       </widget>
@@ -1028,6 +1310,7 @@ Custom
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_palette_color_set"/>
                                       </widget>
@@ -1043,6 +1326,7 @@ Custom
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_palette_color_set"/>
                                       </widget>
@@ -1058,6 +1342,7 @@ Custom
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <property name="color">#000000000000</property>
                                         <signal name="color_set" handler="on_palette_color_set"/>
                                       </widget>
@@ -1072,28 +1357,34 @@ Custom
                                     <property name="right_attach">2</property>
                                     <property name="top_attach">1</property>
                                     <property name="bottom_attach">2</property>
-                                    <property name="y_options"></property>
+                                    <property name="y_options"/>
                                   </packing>
                                 </child>
                               </widget>
                             </child>
                           </widget>
                           <packing>
+                            <property name="expand">True</property>
+                            <property name="fill">True</property>
                             <property name="position">1</property>
                           </packing>
                         </child>
                       </widget>
                       <packing>
+                        <property name="expand">True</property>
+                        <property name="fill">True</property>
                         <property name="position">1</property>
                       </packing>
                     </child>
                     <child>
                       <widget class="GtkVBox" id="vbox9">
                         <property name="visible">True</property>
+                        <property name="can_focus">False</property>
                         <property name="spacing">6</property>
                         <child>
                           <widget class="GtkLabel" id="label9">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="xalign">0</property>
                             <property name="label" translatable="yes">&lt;b&gt;Effects&lt;/b&gt;</property>
                             <property name="use_markup">True</property>
@@ -1107,10 +1398,12 @@ Custom
                         <child>
                           <widget class="GtkAlignment" id="alignment1">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="left_padding">12</property>
                             <child>
                               <widget class="GtkTable" id="table4">
                                 <property name="visible">True</property>
+                                <property name="can_focus">False</property>
                                 <property name="n_rows">2</property>
                                 <property name="n_columns">2</property>
                                 <property name="column_spacing">12</property>
@@ -1118,13 +1411,14 @@ Custom
                                 <child>
                                   <widget class="GtkLabel" id="label19">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <property name="xalign">0</property>
                                     <property name="label" translatable="yes">Transparency:</property>
                                     <property name="use_markup">True</property>
                                   </widget>
                                   <packing>
                                     <property name="x_options">GTK_FILL</property>
-                                    <property name="y_options"></property>
+                                    <property name="y_options"/>
                                   </packing>
                                 </child>
                                 <child>
@@ -1139,12 +1433,13 @@ Custom
                                   <packing>
                                     <property name="left_attach">1</property>
                                     <property name="right_attach">2</property>
-                                    <property name="y_options"></property>
+                                    <property name="y_options"/>
                                   </packing>
                                 </child>
                                 <child>
                                   <widget class="GtkLabel" id="label21">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <property name="xalign">0</property>
                                     <property name="label" translatable="yes">Background image:</property>
                                     <property name="use_markup">True</property>
@@ -1153,19 +1448,23 @@ Custom
                                     <property name="top_attach">1</property>
                                     <property name="bottom_attach">2</property>
                                     <property name="x_options">GTK_FILL</property>
-                                    <property name="y_options"></property>
+                                    <property name="y_options"/>
                                   </packing>
                                 </child>
                                 <child>
                                   <widget class="GtkHBox" id="hbox4">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <property name="spacing">4</property>
                                     <child>
                                       <widget class="GtkFileChooserButton" id="background_image">
                                         <property name="visible">True</property>
+                                        <property name="can_focus">False</property>
                                         <signal name="selection_changed" handler="on_background_image_changed"/>
                                       </widget>
                                       <packing>
+                                        <property name="expand">True</property>
+                                        <property name="fill">True</property>
                                         <property name="position">0</property>
                                       </packing>
                                     </child>
@@ -1174,10 +1473,12 @@ Custom
                                         <property name="visible">True</property>
                                         <property name="can_focus">True</property>
                                         <property name="receives_default">True</property>
+                                        <property name="use_action_appearance">False</property>
                                         <signal name="clicked" handler="clear_background_image"/>
                                         <child>
                                           <widget class="GtkImage" id="image1">
                                             <property name="visible">True</property>
+                                            <property name="can_focus">False</property>
                                             <property name="stock">gtk-clear</property>
                                             <property name="icon-size">1</property>
                                           </widget>
@@ -1185,6 +1486,7 @@ Custom
                                       </widget>
                                       <packing>
                                         <property name="expand">False</property>
+                                        <property name="fill">True</property>
                                         <property name="position">1</property>
                                       </packing>
                                     </child>
@@ -1194,18 +1496,22 @@ Custom
                                     <property name="right_attach">2</property>
                                     <property name="top_attach">1</property>
                                     <property name="bottom_attach">2</property>
-                                    <property name="y_options"></property>
+                                    <property name="y_options"/>
                                   </packing>
                                 </child>
                               </widget>
                             </child>
                           </widget>
                           <packing>
+                            <property name="expand">True</property>
+                            <property name="fill">True</property>
                             <property name="position">1</property>
                           </packing>
                         </child>
                       </widget>
                       <packing>
+                        <property name="expand">True</property>
+                        <property name="fill">True</property>
                         <property name="position">2</property>
                       </packing>
                     </child>
@@ -1217,6 +1523,7 @@ Custom
                 <child>
                   <widget class="GtkLabel" id="label7">
                     <property name="visible">True</property>
+                    <property name="can_focus">False</property>
                     <property name="label" translatable="yes">Appearance</property>
                     <property name="use_markup">True</property>
                   </widget>
@@ -1229,6 +1536,7 @@ Custom
                 <child>
                   <widget class="GtkHBox" id="hbox3">
                     <property name="visible">True</property>
+                    <property name="can_focus">False</property>
                     <property name="border_width">8</property>
                     <child>
                       <widget class="GtkScrolledWindow" id="scrolledwindow1">
@@ -1246,6 +1554,8 @@ Custom
                         </child>
                       </widget>
                       <packing>
+                        <property name="expand">True</property>
+                        <property name="fill">True</property>
                         <property name="position">0</property>
                       </packing>
                     </child>
@@ -1257,6 +1567,7 @@ Custom
                 <child>
                   <widget class="GtkLabel" id="label30">
                     <property name="visible">True</property>
+                    <property name="can_focus">False</property>
                     <property name="label" translatable="yes">Keyboard shortcuts</property>
                   </widget>
                   <packing>
@@ -1268,20 +1579,24 @@ Custom
                 <child>
                   <widget class="GtkFrame" id="frame3">
                     <property name="visible">True</property>
+                    <property name="can_focus">False</property>
                     <property name="border_width">10</property>
                     <property name="label_xalign">0</property>
                     <property name="shadow_type">none</property>
                     <child>
                       <widget class="GtkAlignment" id="alignment3">
                         <property name="visible">True</property>
+                        <property name="can_focus">False</property>
                         <property name="left_padding">12</property>
                         <child>
                           <widget class="GtkVBox" id="vbox7">
                             <property name="visible">True</property>
+                            <property name="can_focus">False</property>
                             <property name="spacing">6</property>
                             <child>
                               <widget class="GtkLabel" id="label51">
                                 <property name="visible">True</property>
+                                <property name="can_focus">False</property>
                                 <property name="xalign">0</property>
                                 <property name="yalign">7.4505801528346183e-09</property>
                                 <property name="label" translatable="yes">&lt;small&gt;&lt;i&gt;&lt;b&gt;Note:&lt;/b&gt; These options may cause some applications to behave incorrectly.  They are only here to allow you to work around certain applications and operating systems that expect different terminal behavior.&lt;/i&gt;&lt;/small&gt;</property>
@@ -1290,12 +1605,14 @@ Custom
                               </widget>
                               <packing>
                                 <property name="expand">False</property>
+                                <property name="fill">True</property>
                                 <property name="position">0</property>
                               </packing>
                             </child>
                             <child>
                               <widget class="GtkTable" id="table30">
                                 <property name="visible">True</property>
+                                <property name="can_focus">False</property>
                                 <property name="n_rows">2</property>
                                 <property name="n_columns">3</property>
                                 <property name="column_spacing">12</property>
@@ -1303,6 +1620,7 @@ Custom
                                 <child>
                                   <widget class="GtkComboBox" id="delete-binding-combobox">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <property name="items" translatable="yes">ASCII DEL
 Escape sequence
 Control-H</property>
@@ -1319,6 +1637,7 @@ Control-H</property>
                                 <child>
                                   <widget class="GtkComboBox" id="backspace-binding-combobox">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <property name="items" translatable="yes">ASCII DEL
 Escape sequence
 Control-H</property>
@@ -1333,6 +1652,7 @@ Control-H</property>
                                 <child>
                                   <widget class="GtkLabel" id="backspace-binding-combobox-label">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <property name="xalign">0</property>
                                     <property name="label" translatable="yes">_Backspace key generates:</property>
                                     <property name="use_underline">True</property>
@@ -1341,12 +1661,13 @@ Control-H</property>
                                   </widget>
                                   <packing>
                                     <property name="x_options">GTK_FILL</property>
-                                    <property name="y_options"></property>
+                                    <property name="y_options"/>
                                   </packing>
                                 </child>
                                 <child>
                                   <widget class="GtkLabel" id="delete-binding-combobox-label">
                                     <property name="visible">True</property>
+                                    <property name="can_focus">False</property>
                                     <property name="xalign">0</property>
                                     <property name="label" translatable="yes">_Delete key generates:</property>
                                     <property name="use_underline">True</property>
@@ -1357,18 +1678,20 @@ Control-H</property>
                                     <property name="top_attach">1</property>
                                     <property name="bottom_attach">2</property>
                                     <property name="x_options">GTK_FILL</property>
-                                    <property name="y_options"></property>
+                                    <property name="y_options"/>
                                   </packing>
                                 </child>
                               </widget>
                               <packing>
                                 <property name="expand">False</property>
+                                <property name="fill">True</property>
                                 <property name="position">1</property>
                               </packing>
                             </child>
                             <child>
                               <widget class="GtkAlignment" id="alignment010101">
                                 <property name="visible">True</property>
+                                <property name="can_focus">False</property>
                                 <property name="xalign">1.1175900205273592e-08</property>
                                 <property name="xscale">0</property>
                                 <property name="yscale">0</property>
@@ -1378,6 +1701,7 @@ Control-H</property>
                                     <property name="visible">True</property>
                                     <property name="can_focus">True</property>
                                     <property name="receives_default">False</property>
+                                    <property name="use_action_appearance">False</property>
                                     <property name="use_underline">True</property>
                                     <signal name="clicked" handler="on_reset_compat_defaults_clicked"/>
                                     <signal name="clicked" handler="reload_erase_combos"/>
@@ -1397,6 +1721,7 @@ Control-H</property>
                     <child>
                       <widget class="GtkLabel" id="label5">
                         <property name="visible">True</property>
+                        <property name="can_focus">False</property>
                         <property name="ypad">6</property>
                         <property name="label" translatable="yes">&lt;b&gt;Keyboard compatibility&lt;/b&gt;</property>
                         <property name="use_markup">True</property>
@@ -1413,6 +1738,7 @@ Control-H</property>
                 <child>
                   <widget class="GtkLabel" id="label3">
                     <property name="visible">True</property>
+                    <property name="can_focus">False</property>
                     <property name="label" translatable="yes">Compatibility</property>
                   </widget>
                   <packing>
@@ -1431,6 +1757,7 @@ Control-H</property>
             <child>
               <widget class="GtkHButtonBox" id="hbuttonbox1">
                 <property name="visible">True</property>
+                <property name="can_focus">False</property>
                 <property name="layout_style">end</property>
                 <child>
                   <widget class="GtkButton" id="button1">
@@ -1438,6 +1765,7 @@ Control-H</property>
                     <property name="visible">True</property>
                     <property name="can_focus">True</property>
                     <property name="receives_default">False</property>
+                    <property name="use_action_appearance">False</property>
                     <property name="use_stock">True</property>
                     <signal name="clicked" handler="gtk_widget_destroy" object="config-window"/>
                   </widget>
@@ -1456,6 +1784,8 @@ Control-H</property>
             </child>
           </widget>
           <packing>
+            <property name="expand">True</property>
+            <property name="fill">True</property>
             <property name="position">1</property>
           </packing>
         </child>
diff --git a/src/guake b/src/guake
index 6d8f9c5..8ccc2c6 100644
--- a/src/guake
+++ b/src/guake
@@ -125,6 +125,10 @@ class GConfHandler(object):
         #notify_add(KEY('/general/use_popup'), self.popup_toggled)
         #notify_add(KEY('/general/window_losefocus'), self.losefocus_toggled)
 
+        # Notification is not required for primary_display/display_n because
+        # get_final_window_rect polls gconf and is called whenever Guake is
+        # shown or resized
+
         notify_add(KEY('/general/show_resizer'), self.show_resizer_toggled)
 
         notify_add(KEY('/general/use_trayicon'), self.trayicon_toggled)
@@ -781,7 +785,7 @@ class Guake(SimpleGladeApp):
             self.set_terminal_focus()
         else:
             self.hide()
- 
+
     def show(self):
         """Shows the main window and grabs the focus on it.
         """
@@ -824,6 +824,8 @@ class Guake(SimpleGladeApp):
         """Gets the final size of the main window of guake. The height
         is the window_height property, width is window_width and the
         horizontal alignment is given by window_alignment.
+
+        This function is called whenever Guake is shown or resized.
         """
         screen = self.window.get_screen()
         height = self.client.get_int(KEY('/general/window_height'))
@@ -833,7 +835,22 @@ class Guake(SimpleGladeApp):
         # get the rectangle just from the first/default monitor in the
         # future we might create a field to select which monitor you
         # wanna use
-        window_rect = screen.get_monitor_geometry(0)
+        use_primary = self.client.get_bool(KEY('/general/primary_display'))
+        dest_screen = self.client.get_int(KEY('/general/display_n'))
+
+        if use_primary:
+            dest_screen = screen.get_primary_monitor()
+
+        # If Guake is configured to use a screen that is not currently attached,
+        # default to 'primary display' option.
+        n_screens = screen.get_n_monitors()
+        if dest_screen > n_screens - 1:
+            self.client.set_bool(KEY('/general/primary_display'), True)
+            self.client.set_int(KEY('/general/display_n'), dest_screen)
+            dest_screen = screen.get_primary_monitor()
+
+        # get the rectangle just from the destination monitor
+        window_rect = screen.get_monitor_geometry(dest_screen)
         if os.environ.get('DESKTOP_SESSION')  == "ubuntu":
             unity_hide = self.client.get_int(KEY('/apps/compiz-1/plugins/' \
                 'unityshell/screen0/options/launcher_hide_mode'))
@@ -852,11 +869,11 @@ class Guake(SimpleGladeApp):
 
         if width < total_width:
             if halignment == ALIGN_CENTER:
-                window_rect.x = (total_width - window_rect.width) / 2
+                window_rect.x += (total_width - window_rect.width) / 2
             elif halignment == ALIGN_LEFT:
-                window_rect.x = 0
+                window_rect.x += 0
             elif halignment == ALIGN_RIGHT:
-                window_rect.x = total_width - window_rect.width
+                window_rect.x += total_width - window_rect.width
         window_rect.y = 0
         return window_rect
 
@@ -867,6 +884,8 @@ class Guake(SimpleGladeApp):
         self.client.notify(KEY('/general/use_trayicon'))
         self.client.notify(KEY('/general/prompt_on_quit'))
         self.client.notify(KEY('/general/window_tabbar'))
+        self.client.notify(KEY('/general/primary_display'))
+        self.client.notify(KEY('/general/display_n'))
         self.client.notify(KEY('/general/window_ontop'))
         self.client.notify(KEY('/general/window_height'))
         self.client.notify(KEY('/general/use_scrollbar'))
diff --git a/src/prefs.py b/src/prefs.py
index 6611635..bd2fb27 100644
--- a/src/prefs.py
+++ b/src/prefs.py
@@ -157,6 +157,11 @@ class PrefsCallbacks(object):
         """
         self.client.set_bool(KEY('/general/use_popup'), chk.get_active())
 
+    def on_prompt_on_quit_toggled(self, chk):
+        """Set the `prompt on quit' property in gconf
+        """
+        self.client.set_bool(KEY('/general/prompt_on_quit'), chk.get_active())
+
     def on_window_ontop_toggled(self, chk):
         """Changes the activity of window_ontop in gconf
         """
@@ -177,17 +182,29 @@ class PrefsCallbacks(object):
         """
         self.client.set_bool(KEY('/general/start_fullscreen'), chk.get_active())
 
+    def on_primary_display_toggled(self, chk):
+        """Set the 'appear on primary display' preference in gconf. This
+        property supercedes any value stored in display_n.
+        """
+        self.client.set_bool(KEY('/general/primary_display'), chk.get_active())
+
+    def on_display_n_changed(self, combo):
+        """Set the destination display in gconf. This is superceded by a 'true'
+        value in primary_display.
+        """
+        i = combo.get_active_iter()
+        if not i:
+            return
+        val = combo.get_model().get_value(i, 0)
+        val_int = int(val.split()[0]) # extracts 1 from '1' or from '1 (primary)'
+        self.client.set_int(KEY('/general/display_n'), val_int)
+
     def on_window_height_value_changed(self, hscale):
         """Changes the value of window_height in gconf
         """
         val = hscale.get_value()
         self.client.set_int(KEY('/general/window_height'), int(val))
 
-    def on_prompt_on_quit_toggled(self, chk):
-        """Set the `prompt on quit' property in gconf
-        """
-        self.client.set_bool(KEY('/general/prompt_on_quit'), chk.get_active())
-
     # scrolling tab
 
     def on_use_scrollbar_toggled(self, chk):
@@ -288,7 +305,7 @@ class PrefsDialog(SimpleGladeApp):
         self.get_widget('image_logo').set_from_file(ipath)
 
         # the first position in tree will store the keybinding path in gconf,
-        # and the user doesn't worry with this, lest hide that =D
+        # and the user doesn't worry with this, let's hide that =D
         model = gtk.TreeStore(str, str, object, bool)
         treeview = self.get_widget('treeview-keys')
         treeview.set_model(model)
@@ -318,6 +335,7 @@ class PrefsDialog(SimpleGladeApp):
 
         self.populate_shell_combo()
         self.populate_keys_tree()
+        self.populate_display_n()
         self.load_configs()
         self.get_widget('config-window').hide()
 
@@ -370,6 +388,12 @@ class PrefsDialog(SimpleGladeApp):
         """
         self.get_widget('font_style').set_sensitive(not chk.get_active())
 
+    def toggle_display_n_sensitivity(self, chk):
+        """When the user unchecks 'primary display', the option to select an
+        alternate display should be enabeld.
+        """
+        self.get_widget('display_n').set_sensitive(not chk.get_active())
+
     def clear_background_image(self, btn):
         """Unset the gconf variable that holds the name of the
         background image of all terminals.
@@ -415,7 +439,7 @@ class PrefsDialog(SimpleGladeApp):
         for i in range(len(PALETTES)):
             if palette == PALETTES[i]:
                 self.get_widget('palette_name').set_active(i)
-    
+
     def set_palette_colors(self, palette):
         """Updates the color buttons with the given palette
         """
@@ -479,7 +503,7 @@ class PrefsDialog(SimpleGladeApp):
         value = self.client.get_bool(KEY('/general/window_losefocus'))
         self.get_widget('window_losefocus').set_active(value)
 
-        # tabbar
+        # tab bar
         value = self.client.get_bool(KEY('/general/window_tabbar'))
         self.get_widget('window_tabbar').set_active(value)
 
@@ -487,6 +511,27 @@ class PrefsDialog(SimpleGladeApp):
         value = self.client.get_bool(KEY('/general/start_fullscreen'))
         self.get_widget('start_fullscreen').set_active(value)
 
+        # display number / use primary display
+        combo = self.get_widget('display_n')
+        dest_screen = self.client.get_int(KEY('/general/display_n'))
+
+        # If Guake is configured to use a screen that is not currently attached,
+        # default to 'primary display' option.
+        screen = self.get_widget('config-window').get_screen()
+        n_screens = screen.get_n_monitors()
+        if dest_screen > n_screens - 1:
+            self.client.set_bool(KEY('/general/primary_display'), True)
+            dest_screen = screen.get_primary_monitor()
+            self.client.set_int(KEY('/general/display_n'), dest_screen)
+
+        for i in combo.get_model():
+            i_int = int(i[0].split()[0]) # extracts 1 from '1' or from '1 (primary)'
+            if i_int == dest_screen:
+                combo.set_active_iter(i.iter)
+
+        value = self.client.get_bool(KEY('/general/primary_display'))
+        self.get_widget('primary_display').set_active(value)
+
         # scrollbar
         value = self.client.get_bool(KEY('/general/use_scrollbar'))
         self.get_widget('use_scrollbar').set_active(value)
@@ -532,7 +577,7 @@ class PrefsDialog(SimpleGladeApp):
         value = self.client.get_string(KEY('/style/font/palette'))
         self.set_palette_name(value)
         self.set_palette_colors(value)
-    
+
         # background image
         value = self.client.get_string(KEY('/style/background/image'))
         if os.path.isfile(value or ''):
@@ -547,7 +592,7 @@ class PrefsDialog(SimpleGladeApp):
     # -- populate functions --
 
     def populate_shell_combo(self):
-        """Read the /etc/shells and looks for installed pythons to
+        """Read the /etc/shells and looks for installed shells to
         fill the default_shell combobox.
         """
         cb = self.get_widget('default_shell')
@@ -587,6 +632,20 @@ class PrefsDialog(SimpleGladeApp):
                           3, True)
         self.get_widget('treeview-keys').expand_all()
 
+    def populate_display_n(self):
+        """Get the number of displays and populate this drop-down box
+        with them all.
+        """
+        cb = self.get_widget('display_n')
+        screen = self.get_widget('config-window').get_screen()
+
+        for m in range(0, int(screen.get_n_monitors())):
+            if m == int(screen.get_primary_monitor()):
+                # TODO l10n
+                cb.append_text(str(m) + ' ' + '(primary)')
+            else:
+                cb.append_text(str(m))
+
     # -- key handling --
 
     def on_key_edited(self, renderer, path, keycode, mask, keyval, model):
-- 
1.7.10.4

